#cloud-config
package_upgrade: true
disable_root: true
users:
  - name: ${ ssh_username }
    passwd: ${ bcrypt(ssh_password) }
    groups: [adm]
    lock-passwd: %{ if length(ssh_public_keys) > 0 }true%{ else }false%{ endif }
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/sh
%{ if length(ssh_public_keys) > 0 ~}
    ssh_authorized_keys:
%{ for key in ssh_public_keys ~}
      - ${key}
%{ endfor ~}
%{ endif ~}
runcmd:
  - [ rm, -f, /root/.ssh/authorized_keys ]
